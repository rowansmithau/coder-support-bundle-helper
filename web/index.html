<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Coder Support Bundle Viewer</title>
  <link rel="stylesheet" href="/style.css"/>
</head>
<body>
<header>
  <h1>Coder Support Bundle Viewer</h1>
  <div class="header-actions">
    <a id="grafana-btn" class="grafana-btn" target="_blank" style="display:none">Grafana</a>
    <a id="prometheus-btn" class="prometheus-btn" target="_blank" style="display:none">Prometheus</a>
    <button id="timeseries-btn" class="timeseries-btn" style="display:none">Time Series Analysis</button>
    <button id="upload-btn" class="upload-btn">Upload Bundle</button>
    <input type="file" id="upload-input" accept=".zip" style="display: none;">
  </div>
</header>

<!-- Bundle Metadata Panel -->
<section id="metadata-panel" class="metadata-panel hidden">
  <div class="metadata-heading">
    <h3>Bundle Information</h3>
    <div class="capture-info">
      <span class="metadata-label">Captured:</span>
      <span id="health-time" class="capture-value">—</span>
    </div>
  </div>
  <div class="metadata-grid">
    <div class="metadata-item deployment">
      <span class="metadata-label">Deployment ID:</span>
      <span id="deployment-id" class="metadata-value">—</span>
    </div>
    <div class="metadata-item">
      <span class="metadata-label">Version:</span>
      <span id="version" class="metadata-value">—</span>
    </div>
    <div class="metadata-item">
      <span class="metadata-label">Dashboard URL:</span>
      <span id="dashboard-url" class="metadata-value">—</span>
    </div>
    <div class="metadata-item">
      <span class="metadata-label">License Status:</span>
      <span id="license-status" class="metadata-value">—</span>
    </div>
  </div>
  <div id="license-details" class="license-details hidden">
    <div class="license-alert" id="license-alert"></div>
    <details class="license-data">
      <summary>View Deployment Details</summary>
      <div id="license-json" class="license-sections"></div>
    </details>
  </div>
</section>

<!-- Network Panel -->
<section id="network-panel" class="network-panel hidden">
  <div class="network-header">
    <h3>Network Information</h3>
    <div id="network-health-badge" class="network-badge muted">No data</div>
  </div>
  <p id="network-health-message" class="network-message"></p>
  <div id="network-alerts" class="network-alerts hidden"></div>
  <div class="network-columns">
    <div class="network-section">
      <h4>Summary</h4>
      <div id="network-summary" class="network-summary-list"></div>
    </div>
    <div class="network-section" id="network-regions-section">
      <h4>DERP Regions</h4>
      <div id="network-regions" class="network-region-list"></div>
    </div>
  </div>
</section>

<!-- Health Panel -->
<section id="health-panel" class="health-panel hidden">
  <h3>System Health</h3>
  <div id="health-status-badge" class="health-badge"></div>
  <div id="health-components" class="health-components hidden"></div>
  <ul id="health-warnings" class="health-warnings"></ul>
  <div id="health-notes" class="health-notes hidden"></div>
</section>

<!-- Comparison Panel -->
<section id="comparison-panel" class="comparison-panel hidden">
  <div class="comparison-header">
    <h3>Profile Comparison</h3>
    <div id="selected-profiles-list"></div>
    <button id="compare-btn" class="compare-btn" disabled>Select 2 profiles to compare</button>
  </div>
</section>

<section id="bundles" class="bundles-panel"></section>

<!-- Comparison Modal -->
<div id="comparison-modal" class="modal hidden">
  <div class="modal-content">
    <button id="close-modal" class="close-modal">&times;</button>
    <div id="comparison-results"></div>
  </div>
</div>

<!-- Time Series Modal -->
<div id="timeseries-modal" class="modal hidden">
  <div class="modal-content">
    <button id="close-timeseries" class="close-modal">&times;</button>
    <h3>Time Series Analysis</h3>
    <div id="timeseries-content"></div>
  </div>
</div>

<template id="bundle-tpl">
  <section class="bundle-panel">
    <div class="bundle-header">
      <h3>Profile Data</h3>
      <div class="bundle-subtitle"></div>
    </div>
    <div class="bundle-meta"></div>
    <div class="bundle-warnings hidden"></div>
    <div class="bundle-content">
      <div class="profiles"></div>
    </div>
  </section>
</template>

<template id="profile-tpl">
  <div class="profile">
    <div class="row header">
      <div class="profile-info">
        <input type="checkbox" class="compare-checkbox">
        <div class="title"></div>
        <div class="tags"></div>
      </div>
    </div>
    <div class="row">
      <div class="summary"></div>
      <div class="actions">
        <button class="show-top">Top</button>
        <button class="show-flame">Flame</button>
        <button class="show-search">Search</button>
        <a class="pprof">Open pprof UI</a>
        <div class="dropdown">
          <button class="dropdown-btn">Export ▼</button>
          <div class="dropdown-content">
            <a class="export-csv">Export as CSV</a>
            <a class="export-json">Export as JSON</a>
            <a class="export-raw">Export Raw</a>
          </div>
        </div>
        <a class="download" target="_blank" style="display:none">Download</a>
      </div>
    </div>
    <div class="panel top hidden">
      <table class="top-table">
        <thead><tr><th>Function</th><th>File</th><th>Flat</th><th>Flat%</th><th>Cum</th><th>Cum%</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="panel flame hidden">
      <canvas class="flamecanvas" width="1400" height="400"></canvas>
    </div>
    <div class="panel search hidden"></div>
  </div>
</template>

<script src="/app.js"></script>
</body>
</html>
